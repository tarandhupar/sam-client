<sam-alert type="info" class="usa-alert-main" title="Migrate Your Roles">
  If you have a user account at any of the <a routerLink="/profile/migrations" fragment="legacy-sites">websites</a> that are moving to the new SAM.gov,
  you may migrate your roles and keep your same permissions. <a routerLink="/profile/migrations" fragment="top">Begin Now</a>.
</sam-alert>

<h2 [innerHTML]="store.title"></h2>
<div>
  <form *ngIf="detailsForm" [formGroup]="detailsForm">
    <!--============================-->
    <!--=== Identity Information ===-->
    <!--============================-->
    <section class="identity" [ngClass]="{ 'usa-editable': isEdit('identity') }">
      <h3>Identifying Information<a class="usa-edit" href="javascript:void(0);" (click)="edit('identity')">Edit</a></h3>
      <div class="usa-form-group">
        <label>Name:</label>
        <div class="usa-form-control" [innerText]="name"></div>
      </div>
      <div class="usa-form-group">
        <label>Suffix:</label>
        <div class="usa-form-control" [innerText]="user.suffix"></div>
      </div>
      <div class="usa-form-group">
        <label>Email:</label>
        <div class="usa-form-control" [innerText]="user.email"></div>
      </div>
      <div class="usa-form-group">
        <label>Notifications:</label>
        <div class="usa-form-control" [innerText]="(user.emailNotification ? 'On' : 'Off')"></div>
      </div>

      <sam-name-entry class="usa-form-editable" [model]="user" legend=""></sam-name-entry>

      <ul class="usa-unstyled-list usa-form-editable">
        <li>
          <input type="checkbox"
                 id="email-notification"
                 type="checkbox"
                 name="email-notification"
                 [checked]="user.emailNotification"
                 (change)="user.emailNotification = !user.emailNotification">
          <label for="email-notification">I would like to be contacted when changes are made to the new SAM.gov</label>
        </li>
      </ul>

      <div class="usa-button-controls">
        <sam-button [buttonType]="(states.loading ? 'disabled' : 'default')" buttonClass="usa-save" buttonText="Save" (onClick)="save('identity')"></sam-button>
        <sam-alert [type]="alerts.identity.type"
                   [title]="alerts.identity.message"
                   [showClose]="true"
                   [hidden]="!alerts.identity.show"
                   (dismiss)="dismiss('identity')"></sam-alert>
      </div>
    </section>
    <!--============================-->
    <!--=== Business Information ===-->
    <!--============================-->
    <section class="business" [ngClass]="{ 'usa-editable': isEdit('business') }">
      <h3>
        <span [innerText]="states.isGov ? 'Organization Information' : 'Business Information'"></span>
        <a class="usa-edit" href="javascript:void(0);" (click)="edit('business')">Edit</a>
      </h3>

      <div class="usa-form-group" *ngIf="states.isGov">
        <label>Department:</label>
        <div class="usa-form-control" [innerText]="hierarchy.department"></div>
      </div>
      <div class="usa-form-group" *ngIf="states.isGov">
        <label>Agency:</label>
        <div class="usa-form-control" [innerText]="hierarchy.agency"></div>
      </div>
      <div class="usa-form-group" *ngIf="states.isGov">
        <label>Office:</label>
        <div class="usa-form-control" [innerText]="hierarchy.office"></div>
      </div>
      <div class="usa-form-group" *ngIf="states.isGov">
        <label>Activity Access Code:</label>
        <div class="usa-form-control" [innerText]="hierarchy.aac"></div>
      </div>

      <div class="usa-form-group">
        <label>Business Phone:</label>
        <div class="usa-form-control" [innerText]="phone"></div>
      </div>

      <sam-agency-picker *ngIf="states.isGov"
                         class="usa-form-editable"
                         [advancedMode]="true"
                         [multimode]="false"
                         [orgRoot]="user.departmentID"
                         [orgId]="detailsForm.controls.officeID.value"
                         [initial]="[detailsForm.controls.officeID.value]"
                         [label]="'Select the office you work for:'"
                         (orgFullPath)="setHierarchy($event)"
                         (organization)="setAAC($event)"
                         #agencyPicker>
      </sam-agency-picker>

      <sam-phone-entry class="usa-form-editable" [model]="user.workPhone" [numbersOnly]="true" (emitter)="updatePhoneNumber($event)" label="Business Phone"></sam-phone-entry>

      <div class="usa-button-controls">
        <sam-button [buttonType]="(states.loading ? 'disabled' : 'default')" buttonClass="usa-save" buttonText="Save" (onClick)="save('business')"></sam-button>
        <sam-alert [type]="alerts.business.type"
                   [title]="alerts.business.message"
                   [showClose]="true"
                   [hidden]="!alerts.business.show"
                   (dismiss)="dismiss('business')"></sam-alert>
      </div>
    </section>
    <!--==========================-->
    <!--=== Security Questions ===-->
    <!--==========================-->
    <section *ngIf="user.kbaAnswerList.length" class="kba" [ngClass]="{ 'usa-editable': isEdit('kba') }">
      <h3>Security Questions<a class="usa-edit" href="javascript:void(0);" (click)="edit('kba')">Edit</a></h3>

      <div *ngFor="let kbaAnswer of user.kbaAnswerList; let $index = index;" class="usa-form-group kba">
        <label [innerText]="question(kbaAnswer.questionId)"></label>
        <div class="usa-form-control" [innerHtml]="getHashedAnswer(kbaAnswer.answer)"></div>
      </div>

      <div class="usa-form-editable" *ngIf="questions.length">
        <sam-kba-entry #kba
                       *ngFor="let kbaAnswer of detailsForm.controls.kbaAnswerList.controls; let $index = index;"
                       [(questions)]="questions[$index]"
                       [question]="detailsForm.controls.kbaAnswerList.controls[$index].controls.questionId"
                       [(answer)]="detailsForm.controls.kbaAnswerList.controls[$index].controls.answer"
                       (onQuestionChange)="changeQuestion($event, $index)"
                       label="Question {{ $index + 1 }}"></sam-kba-entry>
      </div>

      <div class="usa-button-controls">
        <sam-button [buttonType]="(states.loading ? 'disabled' : 'default')" buttonClass="usa-save" buttonText="Save" (onClick)="save('kba')"></sam-button>
      </div>
    </section>
    <section>
      <h3>Deactivate Account</h3>
      <div>
        Once you deactivate your account, you will not be able to recover any of your account information or permissions. Your account will
        be permanently inaccessible and you will need to re-register to access SAM.gov.
      </div>
      <div class="usa-button-controls">
        <sam-button [buttonType]="(states.loading ? 'disabled' : 'secondary')" buttonText="Deactivate Account" (onClick)="confirmDeactivation()"></sam-button>
      </div>
    </section>
  </form>
</div>

<sam-modal #confirmModal
          type="warning"
          title="Are you sure you want to deactivate your account?"
          showClose="true"
          submitButtonLabel="Yes, deactivate my account"
          cancelButtonLabel="No, cancel account deactivation"
          (onSubmit)="reconfirmDeactivation()"></sam-modal>
<sam-modal #reconfirmModal
          type="warning"
          title="Warning"
          description="If you deactivate your account it cannot be reactivated for future use and you will be immediately logged out of the system. Are you sure you want to deactivate your account?"
          showClose="true"
          submitButtonLabel="Yes, continue with deactivation"
          cancelButtonLabel="No, cancel deactivation"
          (onSubmit)="deactivate()"></sam-modal>
