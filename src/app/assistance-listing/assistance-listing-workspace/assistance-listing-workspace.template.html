<page
  *ngIf="permissions && userPermissions"
  theme="inside"
  [breadcrumbs]="crumbs"
  section="Workspace"
  title="Assistance Listings">

  <!-- Sidebar section -->
  <sidebar>

    <!-- Navigation -->
    <ul class="usa-sidenav-list">
      <li>
        <a class="usa-current">
          Assistance Listings
        </a>
      </li>
      <li *ngIf="userPermissions && userPermissions._links && userPermissions._links['program:regional:offices:create']">
        <a id="manage-fal-sidetab"routerLink="/fal/myRegionalAssistanceLocations">
          Manage Assistance Locations
        </a>
      </li>
      <li>
        <a id="cfda-number-management-sidetab" *ngIf="permissions.ORG_LEVELS?.level && permissions.ORG_LEVELS?.level === 'all'" routerLink="/fal/workspace/cfda-numbers">
          CFDA Number Management
        </a>
      </li>
      <li *ngIf="userPermissions && userPermissions._links &&  userPermissions._links['program:template:download']">
        <a (click)="downloadFile()">
          Download New Assistance Listing Template
        </a>
      </li>
    </ul>

    <!-- Filters -->
    <div class="sam-ui segment">

      <!-- Search filter -->
      <div *ngIf="!initLoad" custom-input class="search-bar">
        <h4 class="sam-ui header">Search</h4>
        <sam-autocomplete class="div-fill" #autocomplete
          [(ngModel)]="keyword"
          (ngModelChange)="workspaceSearchModel($event)"
          (enterEvent)="workspaceSearchClick()"
          [config]="workspaceSearchConfig"
          [options]="[]"
          [attr.id]="'fal-workspace-input-search'"
          [allowAny]="true"
          name="appsearch">
        </sam-autocomplete>
        <sam-button class="div-right"
          [buttonType]="'default'"
          [buttonText]="'Search' "
          [buttonClass]="'usa-button usa-search-submit search-btn'"
          (onClick)="workspaceSearchClick()">
        </sam-button>
        <div class="sam-ui divider"></div>
      </div>

      <!--Keywords Filter-->
      <div>
        <h4 class="sam-ui header">Keywords</h4>
        <sam-chips
          class="usa-award-filter"
          [attr.id]="'keywordSearch'"
          [name]="'keywordSearchName'"
          [ngModel]="keywordsModel"
          (ngModelChange)="keywordsModelChange($event)"
          [keyValueConfig]="keywordsConfiguration.keyValueConfig"
          [allowAny]="keywordsConfiguration.allowAny">
        </sam-chips>
      </div>

      <!-- Status Filter -->
      <h4 class="sam-ui header">Status</h4>
      <sam-checkbox
        [(model)]="statusCheckboxModel"
        (modelChange)="statusModelChanged()"
        [name]="statusCheckboxConfig.name"
        [options]="statusCheckboxConfig.options"
        [label]="statusCheckboxConfig.label"
        [hint]="statusCheckboxConfig.hint"
        [errorMessage]="statusCheckboxConfig.errorMessage"
        [hasSelectAll]="statusCheckboxConfig.hasSelectAll"
        [disabled]="disabled">
      </sam-checkbox>

      <!-- Change Request Filter -->
      <ng-container  *ngIf="userPermissions && userPermissions._links && userPermissions._links['program:request:access']">
        <h4 class="sam-ui header">Change Request Pending</h4>
        <sam-checkbox
          [(model)]="requestTypeCheckboxModel"
          (modelChange)="requestTypeModelChanged()"
          [name]="requestTypeCheckboxConfig.name"
          [options]="requestTypeCheckboxConfig.options"
          [label]="requestTypeCheckboxConfig.label"
          [hint]="requestTypeCheckboxConfig.hint"
          [errorMessage]="requestTypeCheckboxConfig.errorMessage"
          [hasSelectAll]="requestTypeCheckboxConfig.hasSelectAll"
          [disabled]="disabled">
        </sam-checkbox>
      </ng-container>

      <!--Date Filter-->
      <sam-select-date-range-filter
        #selectDateFilter
        [tabConfig] = "dateRangeConfig"
        [tabIndex] = "dateFilterIndex"
        [(filterDisabled)] = "filterDisabled"
        [(ngModel)]= "dateFilterModel"
        (ngModelChange) = "dateModelChange($event)"
        (dateIndexChange) = "dateTypeChangeHandler($event)"
        (filterEvt)="filterByDate($event)"
        (filterClearEvt)="clearDateFilter($event)"
        [id]= "'fal-date-range-filter'">
      </sam-select-date-range-filter>

      <!--Agency Picker Filter-->
      <h4 class="sam-ui header">Federal Agency</h4>
      <sam-agency-picker-v2 #agencyPickerV2
        *ngIf="(orgRoots && orgRoots.length>0) || (orgLevels && orgLevels['org'] === 'all')"
        [attr.id] = "'fal-agency-picker-filter'"
        [ngModel]="agencyPickerModel"
        [orgRoots]="orgRoots"
        (ngModelChange)="onOrganizationChange($event)"
        [editOnFlag]="false">
      </sam-agency-picker-v2>

      <br>

      <div>
        <sam-button (onClick)='clearAllFilters()' [buttonText]="'Clear All'"></sam-button>
      </div>

    </div>
  </sidebar>

  <!-- Main Content Section -->
  <sam-button *ngIf="userPermissions && userPermissions._links && userPermissions._links['program:create']"
              [buttonType]="'default'"
              [buttonText]="'Add Assistance Listing' "
              [buttonClass]="'sam-ui button dark blue'"
              (onClick)="addAssistanceListingClick()">
  </sam-button>

  <div *ngIf="showSpinner" id="search-spinner">
    <sam-spinner></sam-spinner>
  </div>

  <!-- No results -->
  <p *ngIf="data.length==0 && !initLoad">
    No results found for '<strong>{{ keywordSplitter(keywordsModel) }}</strong>'
  </p>
  <!-- Page results -->
  <results *ngIf="!data.length==0 && !initLoad && !showSpinner"
           [totalElements]="totalCount"
           [totalPages]="totalPages"
           [currentPage]="pageNum+1"
           (pageChange)="pageChange($event-1)">

    <sam-sort [(ngModel)]="sortModel"
              [options]="sortOptions"
              (ngModelChange)="sortModelChange()">
    </sam-sort>

    <!-- Results -->
    <div class="sam-ui segment" tabindex="-1" *ngFor="let row of data">
      <assistance-program-result
        [data]="row"
        [qParams]="qParams"
        [permissions]="permissions">
      </assistance-program-result>
    </div>


  </results>

</page>
