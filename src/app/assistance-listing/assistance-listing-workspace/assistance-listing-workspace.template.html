<page
  *ngIf="permissions"
  theme="inside"
  [breadcrumbs]="crumbs"
  section="Workspace"
  title="Assistance Listings">

  <!-- Sidebar section -->
  <sidebar>

    <!-- Navigation -->
    <ul class="usa-sidenav-list">
      <li>
        <a class="usa-current">
          Assistance Listings
        </a>
      </li>
      <li *ngIf="permissions['CREATE_RAO']">
        <a routerLink="/fal/myRegionalOffices">
          Manage Assistance Locations
        </a>
      </li>
      <li>
        <a *ngIf="permissions.ORG_LEVELS?.level && permissions.ORG_LEVELS?.level === 'all'" routerLink="/fal/workspace/cfda-numbers">
          CFDA Number Management
        </a>
      </li>
      <li>
        <a routerLink="/workspace/my-feed"
           [queryParams]="{domain: 'al', event: 'request', pending: true}">
          Pending Requests &nbsp;
          <span class="sam-ui circular red mini label">
            {{ pendingRequestCount }}
          </span>
        </a>
      </li>
    </ul>

    <!-- Filters -->
    <div class="sam-ui segment">

      <!-- Search filter -->
      <div *ngIf="!initLoad" custom-input class="search-bar">
        <h4 class="sam-ui header">Search</h4>
        <sam-autocomplete class="div-fill" #autocomplete
          [(ngModel)]="keyword"
          (ngModelChange)="workspaceSearchModel($event)"
          (enterEvent)="workspaceSearchClick()"
          [config]="workspaceSearchConfig"
          [options]="[]"
          [attr.id]="'fal-workspace-input-search'"
          [allowAny]="true"
          name="appsearch">
        </sam-autocomplete>
        <sam-button class="div-right"
          [buttonType]="'default'"
          [buttonText]="'Search' "
          [buttonClass]="'usa-button usa-search-submit search-btn'"
          (onClick)="workspaceSearchClick()">
        </sam-button>
        <div class="sam-ui divider"></div>
      </div>

      <!--Keywords Filter-->
      <div>
        <h4 class="sam-ui header">Keywords</h4>
        <sam-chips
          class="usa-award-filter"
          [attr.id]="'keywordSearch'"
          [name]="'keywordSearchName'"
          [ngModel]="keywordsModel"
          (ngModelChange)="keywordsModelChange($event)"
          [keyValueConfig]="keywordsConfiguration.keyValueConfig"
          [allowAny]="keywordsConfiguration.allowAny">
        </sam-chips>
      </div>

      <!-- Status Filter -->
      <h4 class="sam-ui header">Status</h4>
      <sam-checkbox
        [(model)]="statusCheckboxModel"
        (modelChange)="statusModelChanged()"
        [name]="statusCheckboxConfig.name"
        [options]="statusCheckboxConfig.options"
        [label]="statusCheckboxConfig.label"
        [hint]="statusCheckboxConfig.hint"
        [errorMessage]="statusCheckboxConfig.errorMessage"
        [hasSelectAll]="statusCheckboxConfig.hasSelectAll">
      </sam-checkbox>

      <!-- Change Request Filter -->
      <h4 class="sam-ui header">Change Request Pending</h4>
      <sam-checkbox
        [(model)]="requestTypeCheckboxModel"
        (modelChange)="requestTypeModelChanged()"
        [name]="requestTypeCheckboxConfig.name"
        [options]="requestTypeCheckboxConfig.options"
        [label]="requestTypeCheckboxConfig.label"
        [hint]="requestTypeCheckboxConfig.hint"
        [errorMessage]="requestTypeCheckboxConfig.errorMessage"
        [hasSelectAll]="requestTypeCheckboxConfig.hasSelectAll">
      </sam-checkbox>

      <!--Date Filter-->
      <h4 class="sam-ui header">Date</h4>
      <div class="sam-ui secondary pointing menu">
        <a (click)="selectTab('posted')" class="item" [ngClass]="getColorClass('posted')">
          Posted
        </a>
        <a (click)="selectTab('modified')" class="item" [ngClass]="getColorClass('modified')">
          Modified
        </a>
      </div>
      <sam-date-range-filter *ngIf="isCurrentTab('posted')"
                             #postedDateRangeFilterVar="ngModel"
                             [control]="postedDateRangeFilterVar.control"
                             [(ngModel)]="postedDateFilterModel"
                             (ngModelChange)="dateChangehandler($event)"
                             [radioSelection]="dateFilterConfig.radSelection"
                             [dateRadioOptions]="dateFilterConfig.options"
                             [class]="'falDateFilter'">
      </sam-date-range-filter>
      <sam-date-range-filter *ngIf="isCurrentTab('modified')"
                             #modifiedDateRangeFilterVar="ngModel"
                             [control]="modifiedDateRangeFilterVar.control"
                             [(ngModel)]="modifiedDateFilterModel"
                             (ngModelChange)="dateChangehandler($event)"
                             [radioSelection]="dateFilterConfig.radSelection"
                             [dateRadioOptions]="dateFilterConfig.options"
                             [class]="'falDateFilter'">
      </sam-date-range-filter>

      <sam-button (onClick)='clearDateFilter()' [buttonText]="'Clear'"></sam-button>
      <!--filter button-->
      <sam-button [buttonType]="(filterDisabled? 'disabled' : 'default')" (onClick)='filterByDate()'
                  [buttonText]="'Filter'"></sam-button>


      <!--Agency Picker Filter-->
      <h4 class="sam-ui header">Federal Agency</h4>
      <sam-agency-picker-v2 #agencyPickerV2
        *ngIf="(orgRoots && orgRoots.length>0) || (orgLevels && orgLevels['org'] === 'all')"
        [attr.id] = "'fal-agency-picker-filter'"
        [ngModel]="agencyPickerModel"
        [orgRoots]="orgRoots"
        (ngModelChange)="onOrganizationChange($event)"
        [limit] = '2'>
      </sam-agency-picker-v2>

      <br>

      <div>
        <sam-button (onClick)='clearAllFilters()' [buttonText]="'Clear All'"></sam-button>
      </div>

    </div>
  </sidebar>

  <!-- Main Content Section -->
  <sam-button *ngIf="permissions['CREATE_FALS']"
              [buttonType]="'default'"
              [buttonText]="'Add Assistance Listing' "
              [buttonClass]="'sam-ui button dark blue'"
              (onClick)="addAssistanceListingClick()">
  </sam-button>

  <!-- No results -->
  <p *ngIf="data.length==0 && !initLoad">
    No results found for '<strong>{{ oldKeyword }}</strong>'
  </p>
  <!-- Page results -->
  <results *ngIf="!data.length==0 && !initLoad"
           [totalElements]="totalCount"
           [totalPages]="totalPages"
           [currentPage]="pageNum+1"
           (pageChange)="pageChange($event-1)">

    <sam-sort [(ngModel)]="sortModel"
              [options]="sortOptions"
              (ngModelChange)="sortModelChange()">
    </sam-sort>

    <!-- Results -->
    <div class="sam-ui segment" tabindex="-1" *ngFor="let row of data">
      <assistance-program-result
        [data]="row"
        [qParams]="qParams"
        [permissions]="permissions">
      </assistance-program-result>
    </div>


  </results>

</page>
