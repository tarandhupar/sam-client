<div>
  Select one of our legacy web sites. Then enter the username and password of your legacy account to
  migrate your roles to your new SAM.gov account.
</div>

<div class="usa-content">
  <form *ngIf="migrationForm" [formGroup]="migrationForm" (ngSubmit)="migrate()">
    <div class="usa-grid relative" #form>
      <div class="usa-width-one-half">
        <sam-select label="Web Site"
                    name="system"
                    [(model)]="store.system"
                    [options]="store.systems"
                    [required]="true"
                    [errorMessage]="errors('system')"></sam-select>
      </div>
      <div class="usa-width-one-half">
        <sam-label-wrapper name="legacy-username" label="Email / User ID" required="true" [errorMessage]="errors('username')">
          <input type="text" id="legacy-username" formControlName="username" readonly="readonly" autocomplete="off" onfocus="this.removeAttribute('readonly');" />
        </sam-label-wrapper>
        <sam-label-wrapper name="legacy-password" label="Password" required="true" [errorMessage]="errors('password')">
          <input type="password" id="legacy-password" formControlName="password" readonly="readonly" autocomplete="off" onfocus="this.removeAttribute('readonly');" />
        </sam-label-wrapper>
        <div class="usa-button-controls">
          <button type="submit" class="usa-primary-button" [disabled]="states.loading">Migrate</button>
          <sam-alert [type]="states.confirm.type"
                     [title]="states.confirm.message"
                     [showClose]="true"
                     (dismiss)="alert()"
                     *ngIf="states.confirm.show"></sam-alert>
        </div>
      </div>
    </div>
  </form>
  <div>
    <h3>Role Migration History</h3>
    <div>
      <ng-container *ngIf="!store.migrations.length">You have not yet migrated any legacy roles.</ng-container>
      <ng-container *ngIf="store.migrations.length">Your new role(s) may be named differently than it was in the Legacy System. You privileges are comparable.</ng-container>
    </div>

    <table *ngIf="store.migrations.length" class="usa-table-borderless usa-migration-history">
      <thead>
        <tr>
          <th scope="col" class="text-center">Legacy System</th>
          <th scope="col">Legacy UserID</th>
          <th scope="col">&nbsp;</th>
          <th scope="col">Date/Time of Migration</th>
        </tr>
      </thead>
      <tbody *ngFor="let system of store.migrations | groupBy: 'system'">
        <tr class="group">
          <td>
            <h1 [innerText]="system.key">CFDA.gov</h1>
          </td>
          <td colspan="4">&nbsp;</td>
        </tr>
        <tr *ngFor="let account of system.items; let $first = first; let $last = last" class="group-item" [ngClass]="{ 'group-item-first': $first, 'group-item-last': $last }">
          <td>&nbsp;</td>
          <td>
            <div class="key text-left">
              <span class="fa fa-user"></span>
              <span [innerText]="account.username">-</span>
            </div>
          </td>
          <td>&nbsp;</td>
          <td>
            <div class="key">Migrated <span [innerText]="account.migratedAt">-</span></div>
          </td>
        </tr>
      </tbody>
    </table>

    <h3 id="legacy-sites">Legacy Websites</h3>
    <div>
      The following web sites are being moved to the new SAM.gov. If you currently have legacy accounts in any of these systems
      you will be able to migrate all of your associated roles to the new SAM.gov.
    </div>

    <table class="usa-table-borderless usa-legacy-systems">
      <thead>
        <tr>
          <th scope="col">Website</th>
          <th scope="col">Migration Status</th>
          <th scope="col">System Status</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let system of store.legacy; let $index = index;">
          <td>
            <a [innerText]="system.name"
               [title]="system.name"
               (click)="open(system.target)"></a>
          </td>
          <td [innerText]="system.statuses.migration"></td>
          <td [innerText]="system.statuses.system"></td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
