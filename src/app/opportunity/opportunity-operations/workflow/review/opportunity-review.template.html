
<page
  (breadcrumbOut)="breadcrumbHandler($event)"
  *ngIf="opportunity"
  theme="inside"
  [breadcrumbs]="crumbs"
  section="Contract Opportunity"
  [title]="opportunity?.data?.title">


  <sidebar>
    <div sam-sticky limit=1200 container="page-content">
      <!-- Logo -->
      <ng-container *ngIf="opportunity && (errorOrganization || logoUrl===null || errorLogo)">
        <img src="src/assets/img/logo-not-available.png" class="sidenav-logo" alt="Logo Not Available" width="160px" height="160px">
      </ng-container>
      <ng-container *ngIf="opportunity && logoUrl && !errorOrganization">
        <img class="sidenav-logo" [src]="logoUrl" [alt]="logoInfo" [title]="'Organization Logo'" width="160px" height="160px">
      </ng-container>

      <!--Side Navigation-->
      <sam-sidenav
        type="step"
        (selection)="navHandler($event)"
        [labelLookup]="sideNavSelection"
        [model]="sideNavModel">
      </sam-sidenav>
    </div>
  </sidebar>

  <ng-container message>
    <sam-alert
      [type]="'warning'"
      [hidden]="!(checkForErrors() && reviewErrorList) || (opportunity?.status?.code == 'published' || opportunity?.status?.code == 'archived')">
      <div leading-content>{{statusBannerLeadingText}}</div>
      <div main-content>
        <opp-error-display #errorDisplay
                           (message)="updateBannerText($event)">
        </opp-error-display>
      </div>
    </sam-alert>
  </ng-container>


  <!--Main Content-->
  <div class="usa-width-three-fourths" *ngIf="opportunity">
    <!-- Alert -->
    <ng-container *ngIf="alerts && alerts.length > 0">
      <div *ngFor="let alert of alerts; let i = index">
        <sam-alert
          [attr.id]="'organization-alert-' + i"
          labelname="alerts[i].labelname"
          [type]="alerts[i].config.type"
          [title]="alerts[i].config.title">
          <div [innerHTML]="alerts[i].config.description"></div>
        </sam-alert>
      </div>
    </ng-container>

    <inline-error-message
      [message]="getErrorMessage(getSectionId('HEADER'), getFieldId('TITLE'))">
    </inline-error-message>

    <!-- Tabs -->
    <tabs-opp
      [data]="opportunity"
      (tabClick)="tabsClicked($event)">
    </tabs-opp>


    <!-- Intro Content -->
    <a name="#/opp/{{opportunity.id}}/review#header"></a>
    <section [attr.id]="generateID(opportunityFields.Header)" *ngIf="shouldBeDisplayed(opportunityFields.Header)">
      <div class="sam-ui hidden divider"></div>

      <!-- Edit Button -->
      <div grid class="middle aligned">
        <div columns="9"></div>
        <div columns="3" class="right aligned">
        <a *ngIf="canEdit()"
           (click)="onEditClick(['#header'])">
          Edit Section
          <em class="fa fa-pencil" aria-hidden="true"></em>
        </a>
        </div>
      </div>

      <div class="sam-ui padded raised segment">

        <div class="sam-ui attached grid">
          <div class="column">
            <div class="sam-ui relaxed divided list">

              <div class="item" [attr.id]="generateID(opportunityFields.Solicitation, 'header')" *ngIf="shouldBeDisplayed(opportunityFields.Solicitation)">
                <div class="content">
                  <div class="header">
                    <ng-container *ngIf="opportunity.data?.type && (originalOpportunity?.data?.type || opportunity.parentOpportunityId == null)">
                      <inline-error-message
                        [message]="getErrorMessage(getSectionId('HEADER'),  getFieldId('OPPORTUNITY_TYPE'))">
                      </inline-error-message>
                      {{  numberLabel()}}
                    </ng-container>
                  </div>
                  <div class="description">
                    <inline-error-message
                      [message]="getErrorMessage(getSectionId('HEADER'),  getFieldId('NOTICE_NUMBER'))">
                    </inline-error-message>
                    {{ opportunity.data?.solicitationNumber }}
                  </div>
                </div>
              </div>

              <div class="item"
                   [attr.id]="generateID(opportunityFields.Related, 'header')"
                   *ngIf="shouldBeDisplayed(opportunityFields.Related)">
                <div class="content">
                  <div class="header">
                    Related Notice
                  </div>
                  <div class="description" *ngIf="relatedNoticeNumber">
                    {{ relatedNoticeNumber }}
                  </div>
                </div>
              </div>

              <div class="item" [attr.id]="generateID(opportunityFields.HierarchyName, 'header')" *ngIf="organization && shouldBeDisplayed(opportunityFields.HierarchyName)">
                <div class="content">
                  <div class="header" [ngSwitch]='organization.type'>
                    <ng-container *ngSwitchCase="'DEPARTMENT'">Department/Ind. Agency</ng-container>
                    <ng-container *ngSwitchCase="'AGENCY'">Sub-tier</ng-container>
                    <ng-container *ngSwitchCase="'OFFICE'">Contracting Office</ng-container>
                  </div>
                  <div class="description">
                    <inline-error-message
                      [message]="getErrorMessage(getSectionId('HEADER'),  getFieldId('CONTRACTING_OFFICE'))">
                    </inline-error-message>
                    <ng-container *ngIf="organization.l2Name">
                      {{ organization.l2Name }}
                    </ng-container>
                    <ng-container *ngIf="errorOrganization">
                      Organization ID: {{opportunity.data.organizationId}} NOTE: Complete Federal Hierarchy information is currently unavailable.
                    </ng-container>
                  </div>
                </div>
              </div>
              <div class="item" [attr.id]="generateID(opportunityFields.Location, 'header')" *ngIf="shouldBeDisplayed(opportunityFields.Location)">
                <div class="content">
                  <div class="header">
                    Location
                  </div>
                  <div class="description">
                    <ng-container *ngIf="organization?.name">
                      {{ organization.name }}
                    </ng-container>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="sam-ui hidden divider"></div>
    </section>


    <div [class.hide]="selectedPage !== 0">

      <!-- Award Details -->
      <a name="#/opp/{{opportunity.id}}/review#award"></a>
      <section [attr.id]="generateID(opportunityFields.Award)" *ngIf="shouldBeDisplayed(opportunityFields.Award) && ready">

        <div grid class="middle aligned">
          <div columns="9">
            <h2 class="sam-ui header">Award Details</h2>
          </div>
          <div columns="3" class="right aligned">
            <!-- Edit Link -->
            <a *ngIf="canEdit()"
               (click)="onEditClick(['#award'])">
              Edit Section
              <em class="fa fa-pencil" aria-hidden="true"></em>
            </a>
          </div>
        </div>

        <div class="sam-ui segment">
        <ul class="usa-unstyled-list">
          <li [attr.id]="generateID(opportunityFields.AwardDate)" *ngIf="shouldBeDisplayed(opportunityFields.AwardDate)">
            <strong>Contract Award Date: </strong>
            {{ opportunity.data?.award?.date | dateFormat: 'MMM DD, YYYY' }}
          </li>
          <li [attr.id]="generateID(opportunityFields.AwardNumber)" *ngIf="shouldBeDisplayed(opportunityFields.AwardNumber)">
            <strong>Contract Award Number: </strong>
            {{ opportunity.data?.award?.number }}
          </li>
          <li [attr.id]="generateID(opportunityFields.OrderNumber)" *ngIf="shouldBeDisplayed(opportunityFields.OrderNumber)">
            <strong>Task/Delivery Order Number: </strong>
            {{ opportunity?.data?.award?.deliveryOrderNumber }}
          </li>
          <li [attr.id]="generateID(opportunityFields.AwardedDUNS)" *ngIf="shouldBeDisplayed(opportunityFields.AwardedDUNS)">
            <strong>Contractor Awarded UEI: </strong>
            <span>{{ opportunity.data?.award?.awardee?.duns }}</span>
          </li>
          <li [attr.id]="generateID(opportunityFields.AwardedName)" *ngIf="shouldBeDisplayed(opportunityFields.AwardedName)">
            <strong>Contractor Awarded Name: </strong>
            <span>{{opportunity.data?.award?.awardee?.name}}</span>
          </li>
          <li [attr.id]="generateID(opportunityFields.AwardedAddress)" *ngIf="shouldBeDisplayed(opportunityFields.AwardedAddress)">
            <strong>Contractor Awarded Address: </strong>
            <span>
              {{opportunity.data?.award?.awardee?.location?.streetAddress}}
              {{opportunity.data?.award?.awardee?.location?.city}}
              {{opportunity.data?.award?.awardee?.location?.state}}
              {{opportunity.data?.award?.awardee?.location?.zip}}
              {{opportunity.data?.award?.awardee?.location?.country}}
            </span>
          </li>
          <li [attr.id]="generateID(opportunityFields.AwardAmount)" *ngIf="shouldBeDisplayed(opportunityFields.AwardAmount)">
            <strong>Contract Award Dollar Amount: </strong>
            <span>{{opportunity.data?.award?.amount}}</span>
          </li>
          <li [attr.id]="generateID(opportunityFields.LineItemNumber, 'award')" *ngIf="shouldBeDisplayed(opportunityFields.LineItemNumber)">
            <strong>Contract Line Item Number: </strong>
            <span>{{opportunity.data?.award?.lineItemNumber}}</span>
          </li>
        </ul>
        </div>
        <div class="sam-ui hidden section divider"></div>
      </section>

      <!-- General Information -->
      <a name="#/opp/{{opportunity.id}}/review#general"></a>
      <section [attr.id]="generateID(opportunityFields.General)" *ngIf="shouldBeDisplayed(opportunityFields.General)">
        <div class="sam-ui hidden divider"></div>

        <div grid class="middle aligned">
          <div columns="9">
            <h2 class="sam-ui header">General Information</h2>
          </div>
          <div columns="3" class="right aligned">
            <!-- Edit Link -->
            <a *ngIf="canEdit()"
               (click)="onEditClick(['#general'])">
              Edit Section
              <em class="fa fa-pencil" aria-hidden="true"></em>
            </a>
          </div>
        </div>

        <div class="sam-ui segment">
          <ul class="usa-unstyled-list">
            <li [attr.id]="generateID(opportunityFields.Type, 'general')" *ngIf="shouldBeDisplayed(opportunityFields.Type)">
              <strong>Contract Opportunity Type: </strong>
              <ng-container *ngIf="opportunity.data?.type !== 'm'">Original {{ opportunity.data?.type | opportunityTypeLabel }}</ng-container>
              <ng-container *ngIf="opportunity.data?.type === 'm'">
                <ng-container *ngIf="opportunity.data?.statuses?.isCanceled">Canceled </ng-container>
                <ng-container *ngIf="!opportunity.data?.statuses?.isCanceled">Updated </ng-container>
                {{ originalOpportunity?.data?.type | opportunityTypeLabel}}
              </ng-container>
            </li>
            <li [attr.id]="generateID(opportunityFields.PostedDate, 'general')" *ngIf="shouldBeDisplayed(opportunityFields.PostedDate)">
              <strong>Update/Amendment Posted Date: </strong>
              {{ opportunity?.postedDate | dateFormat: 'MMM DD, YYYY' }}
            </li>
            <li [attr.id]="generateID(opportunityFields.OriginalPostedDate, 'general')" *ngIf="shouldBeDisplayed(opportunityFields.OriginalPostedDate)">
              <strong>Original Posted Date: </strong>
              <ng-container *ngIf="(opportunity.parent | json) != '{}'">{{ originalOpportunity?.postedDate | dateFormat: 'MMM DD, YYYY' }}</ng-container>
              <ng-container *ngIf="(opportunity.parent | json) == '{}'">{{ opportunity?.postedDate | dateFormat: 'MMM DD, YYYY' }}</ng-container>
            </li>
            <li [attr.id]="generateID(opportunityFields.ResponseDate, 'general')" *ngIf="shouldBeDisplayed(opportunityFields.ResponseDate)">
              <strong>Update/Amendment Response Date: </strong>
              {{ opportunity.data?.solicitation?.deadlines?.response | dateFormat: 'MMM DD, YYYY' }}
            </li>
            <li [attr.id]="generateID(opportunityFields.OriginalResponseDate, 'general')" *ngIf="shouldBeDisplayed(opportunityFields.OriginalResponseDate)">
              <strong>Original Response Date: </strong>
              <ng-container *ngIf="(opportunity.parent | json) != '{}'">{{ originalOpportunity?.data?.solicitation?.deadlines?.response | dateFormat: 'MMM DD, YYYY' }}</ng-container>
              <ng-container *ngIf="(opportunity.parent | json) == '{}'">{{ opportunity?.data?.solicitation?.deadlines?.response | dateFormat: 'MMM DD, YYYY' }}</ng-container>
            </li>
            <li [attr.id]="generateID(opportunityFields.ArchivePolicy, 'general')" *ngIf="shouldBeDisplayed(opportunityFields.ArchivePolicy)"
                [ngSwitch]="opportunity.data?.archive?.type">
              <!-- <sam-label *ngIf="differences?.archivingPolicy" [labelType]="'small'" [labelText]="' '"></sam-label> -->
              <strong>Archiving Policy: </strong>
              <inline-error-message
                [message]="getErrorMessage(getSectionId('GENERAL'), getFieldId('ARCHIVE_POLICY'))">
              </inline-error-message>
              <ng-container *ngSwitchCase="'manual'">Manual Archive</ng-container>
              <ng-container *ngSwitchCase="'auto15'">Automatic, 15 days after response date</ng-container>
              <ng-container *ngSwitchCase="'autocustom'">Automatic, on specified date</ng-container>
              <inline-error-message
                [message]="getErrorMessage(getSectionId('GENERAL'), getFieldId('ARCHIVE_DATE'))">
              </inline-error-message>
            </li>
            <li [attr.id]="generateID(opportunityFields.ArchiveDate, 'general')" *ngIf="shouldBeDisplayed(opportunityFields.ArchiveDate)">
              <strong>Update/Amendment Archive Date: </strong>
              {{ opportunity.data?.archive?.date | dateFormat: 'MMM DD, YYYY' }}
            </li>
            <li [attr.id]="generateID(opportunityFields.OriginalArchiveDate, 'general')" *ngIf="shouldBeDisplayed(opportunityFields.OriginalArchiveDate) && showOriginalArchiveDate()">
              <strong>Original Archive Date: </strong>
              <ng-container *ngIf="(opportunity.parent | json) != '{}'">{{ parentArchiveDate() | dateFormat: 'MMM DD, YYYY' }}</ng-container>
              <ng-container *ngIf="(opportunity.parent | json) == '{}'">{{ archiveDate() | dateFormat: 'MMM DD, YYYY' }}</ng-container>
            </li>
            <li [attr.id]="generateID(opportunityFields.StatutoryAuthority, 'general')" *ngIf="shouldBeDisplayed(opportunityFields.StatutoryAuthority)">
              <strong>J&A Statutory Authority: </strong>
              {{ opportunity?.data?.award?.justificationAuthority?.authority }}
            </li>
            <li [attr.id]="generateID(opportunityFields.JustificationAuthority, 'general')" *ngIf="shouldBeDisplayed(opportunityFields.JustificationAuthority)">
              <strong>Fair Opportunity / Limited Sources Justification Authority: </strong>
              <ng-container *ngIf="opportunity?.data?.award?.fairOpportunity?.authority && dictionariesUpdated === true">
                {{ (opportunity?.data?.award?.fairOpportunity?.authority | filterMultiArrayObject:findDictionary('fo_justification_authority'):'elementId':false:'')[0]?.value }}
              </ng-container>
            </li>
            <li [attr.id]="generateID(opportunityFields.ModificationNumber, 'general')" *ngIf="shouldBeDisplayed(opportunityFields.ModificationNumber)">
              <strong>Modification Number: </strong>
              {{ opportunity?.data?.award?.justificationAuthority?.modificationNumber }}
            </li>
            <li [attr.id]="generateID(opportunityFields.SpecialLegislation, 'general')" *ngIf="shouldBeDisplayed(opportunityFields.SpecialLegislation)">
              <strong>Special Legislation: </strong>
              <ul *ngIf="opportunity.data?.flags && opportunity.data?.flags.length > 0">
                <ng-container *ngFor = "let flag of opportunity.data?.flags">
                  <li *ngIf="flag.isSelected===true">
                   Recovery and Reinvestment Act
                  </li>
                  <div *ngIf ="flag.isSelected===false">None</div>
                </ng-container>
              </ul>
            </li>
            <li [attr.id]="generateID(opportunityFields.AllowVendorAddRemoveIvl, 'general')" *ngIf="shouldBeDisplayed(opportunityFields.AllowVendorAddRemoveIvl)">
              <em class="icon fa fa-lock" aria-hidden="true"></em> <strong>Allow Vendors to Add/remove from IVL: </strong>
              <ng-container *ngIf="opportunity?.data?.permissions?.ivl?.create != null && opportunity?.data?.permissions?.ivl?.delete != null && opportunity?.data?.permissions?.ivl?.update != null">
                {{ (opportunity?.data?.permissions?.ivl?.create && opportunity?.data?.permissions?.ivl?.delete && opportunity?.data?.permissions?.ivl?.update) ? 'Yes' : 'No' }}
              </ng-container>
            </li>
            <li [attr.id]="generateID(opportunityFields.AllowVendorViewIvl, 'general')" *ngIf="shouldBeDisplayed(opportunityFields.AllowVendorViewIvl)">
              <em class="icon fa fa-lock" aria-hidden="true"></em> <strong>Allow Vendors to View IVL: </strong>
              <ng-container *ngIf="opportunity?.data?.permissions?.ivl?.read != null">
                {{ (opportunity?.data?.permissions?.ivl?.read) ? 'Yes' : 'No' }}
              </ng-container>
            </li>
          </ul>
        <div class="sam-ui hidden section divider"></div>
        </div>
      </section>

      <!-- Classification -->
      <a name="#/opp/{{opportunity.id}}/review#classification"></a>
      <section [attr.id]="generateID(opportunityFields.Classification)" *ngIf="shouldBeDisplayed(opportunityFields.Classification)">
        <div class="sam-ui hidden divider"></div>
        <div grid class="middle aligned">
          <div columns="9">
        <h2 class="sam-ui header">Classification</h2>
          </div>
          <div columns="3" class="right aligned">
            <!-- Edit Button -->
            <a *ngIf="canEdit()"
               (click)="onEditClick(['#classification'])">
              Edit Section
              <em class="fa fa-pencil" aria-hidden="true"></em>
            </a>
          </div>
        </div>

        <div class="sam-ui segment">
            <ul class="usa-unstyled-list">
              <li [attr.id]="generateID(opportunityFields.OriginalSetAside, 'classification')" *ngIf="shouldBeDisplayed(opportunityFields.OriginalSetAside)">
                <strong> Original Set Aside: </strong>
                <ng-container *ngIf="(opportunity.parent | json) != '{}' && originalOpportunity?.data?.solicitation?.setAside && dictionariesUpdated === true">
                  <ng-container *ngFor = "let element of [originalOpportunity?.data?.solicitation?.setAside] | filterMultiArrayObject:findDictionary('set_aside_type'):'elementId':false:''">
                    <ng-container>{{ element.value }}</ng-container>
                  </ng-container>
                </ng-container>
                <ng-container *ngIf="(opportunity.parent | json) == '{}' && opportunity?.data?.solicitation?.setAside && dictionariesUpdated === true">
                  <ng-container *ngFor = "let element of [opportunity?.data?.solicitation?.setAside] | filterMultiArrayObject:findDictionary('set_aside_type'):'elementId':false:''">
                    <ng-container>{{ element.value }}</ng-container>
                  </ng-container>
                </ng-container>
              </li>
              <li [attr.id]="generateID(opportunityFields.SetAside, 'classification')" *ngIf="shouldBeDisplayed(opportunityFields.SetAside)">
                <ng-container *ngIf="(opportunity.data?.solicitation?.setAside != originalOpportunity?.data?.solicitation?.setAside) && dictionariesUpdated === true">
                  <strong>Update/Amendment Set Aside: </strong>
                  <ng-container *ngFor = "let element of [opportunity.data?.solicitation?.setAside] | filterMultiArrayObject:findDictionary('set_aside_type'):'elementId':false:''">
                    <ng-container> {{ element.value }}</ng-container>
                  </ng-container>
                </ng-container>
              </li>
              <li [attr.id]="generateID(opportunityFields.ClassificationCode, 'classification')" *ngIf="shouldBeDisplayed(opportunityFields.ClassificationCode)">
                <strong>Product Service Code: </strong>
                <inline-error-message
                  [message]="getErrorMessage(getSectionId('CLASSIFICATION'), getFieldId('PRODUCT_SERVICE_CODE'))">
                </inline-error-message>
                <ng-container *ngIf="opportunity.data?.classificationCode && dictionariesUpdated === true">
                  <ng-container *ngFor = "let element of [opportunity.data?.classificationCode] | filterMultiArrayObject:findDictionary('classification_code'):'elementId':false:''">
                    {{ element.value }}
                  </ng-container>
                </ng-container>
              </li>
              <li [attr.id]="generateID(opportunityFields.NAICSCode, 'classification')" *ngIf="shouldBeDisplayed(opportunityFields.NAICSCode)">
                <strong>Primary NAICS Code: </strong>
                <inline-error-message
                  [message]="getErrorMessage(getSectionId('CLASSIFICATION'), getFieldId('PRIMARY_NAICS_CODE'))">
                </inline-error-message>
                <ng-container *ngIf="opportunity.data?.naics && opportunity.data?.naics[0] != null && dictionariesUpdated === true">
                  <ul>
                    <ng-container *ngFor = "let naics of opportunity.data?.naics">
                      <ng-container *ngIf="naics.type == 'Primary' || naics.type == 'primary'">
                        <li *ngFor = "let element of naics.code | filterMultiArrayObject:findDictionary('naics_code'):'elementId':false:''">
                          <ng-container *ngIf="element != null">{{ element.value }}</ng-container>
                        </li>
                      </ng-container>
                    </ng-container>
                  </ul>
                </ng-container>
              </li>
              <li [attr.id]="generateID(opportunityFields.NAICSCodeAdditional, 'classification')" *ngIf="shouldBeDisplayed(opportunityFields.NAICSCodeAdditional)">
                <strong>Additional NAICS Code(s): </strong>
                <ng-container *ngIf="opportunity.data?.naics && opportunity.data?.naics[0] != null && dictionariesUpdated === true">
                  <ul>
                    <ng-container *ngFor = "let naics of opportunity.data?.naics">
                      <ng-container *ngIf="naics.type == 'Secondary' || naics.type == 'secondary'">
                        <li *ngFor = "let element of naics.code | filterMultiArrayObject:findDictionary('naics_code'):'elementId':false:''">
                          <ng-container *ngIf="element != null">{{ element.value }}</ng-container>
                        </li>
                      </ng-container>
                    </ng-container>
                  </ul>
                </ng-container>
              </li>
              <li [attr.id]="generateID(opportunityFields.POP, 'classification')" *ngIf="shouldBeDisplayed(opportunityFields.POP)">
               <strong >Place of Performance: </strong>
                <div [attr.id]="generateID(opportunityFields.POPLocation, 'classification')" *ngIf="shouldBeDisplayed(opportunityFields.POPLocation)">
                  {{opportunity.data?.placeOfPerformance?.streetAddress}}
                </div>

                <div>
                  <span [attr.id]="generateID(opportunityFields.POPCity, 'classification')" *ngIf="shouldBeDisplayed(opportunityFields.POPCity)">
                    {{opportunity.data?.placeOfPerformance?.city}}
                  </span>
                  <ng-container *ngIf="opportunity.data?.placeOfPerformance?.city && opportunity.data?.placeOfPerformance?.state">,</ng-container>
                  <span [attr.id]="generateID(opportunityFields.POPState, 'classification')" *ngIf="shouldBeDisplayed(opportunityFields.POPState)">
                    {{getState(opportunity)}}
                  </span>
                  <inline-error-message
                    [message]="getErrorMessage(getSectionId('CLASSIFICATION'), getFieldId('ZIP'))">
                  </inline-error-message>
                  <span [attr.id]="generateID(opportunityFields.POPZip, 'classification')" *ngIf="shouldBeDisplayed(opportunityFields.POPZip)">
                    {{opportunity.data?.placeOfPerformance?.zip}}
                  </span>
                </div>

                <div [attr.id]="generateID(opportunityFields.POPCountry, 'classification')" *ngIf="shouldBeDisplayed(opportunityFields.POPCountry)">
                  {{opportunity.data?.placeOfPerformance?.country}}
                </div>
              </li>
            </ul>
            <div class="sam-ui hidden section divider"></div>
        </div>
      </section>

      <!-- Synopsis -->
      <a name="#/opp/{{opportunity.id}}/review#description"></a>
      <section [attr.id]="generateID(opportunityFields.Description)" *ngIf="shouldBeDisplayed(opportunityFields.Description)">
        <div class="sam-ui hidden divider"></div>

        <div grid class="middle aligned">
          <div columns="9">
            <h2 class="sam-ui header">Description</h2>
          </div>
          <div columns="3" class="right aligned">
            <!-- Edit Button -->
            <a *ngIf="canEdit()"
             (click)="onEditClick(['#description'])">
             Edit Section
             <em class="fa fa-pencil" aria-hidden="true"></em>
            </a>
          </div>
        </div>

        <div class="sam-ui segment">
          <h3 class="sam-ui dividing header">
            <ng-container *ngIf="opportunity.data?.type === 'i'">Description of Benefits</ng-container>
            <ng-container *ngIf="opportunity.data?.type !== 'i'">Description</ng-container>
          </h3>
          <inline-error-message
            [message]="getErrorMessage(getSectionId('DESCRIPTION'), getFieldId('DESCRIPTION'))">
          </inline-error-message>
          <div [innerHTML]="opportunity.description[0]?.body | fixhtml"></div>
          <div class="sam-ui hidden section divider"></div>
        </div>
      </section>


      <!-- Packages -->
      <a name="#/opp/{{opportunity.id}}/review#packages"></a>
      <section [attr.id]="generateID(opportunityFields.Packages)" *ngIf="shouldBeDisplayed(opportunityFields.Packages) && ready">
        <div class="sam-ui hidden divider"></div>
        <h2 class="sam-ui header">Packages</h2>
        <div class="sam-ui segment">
          <sam-download
            [attachmentError]="attachmentError"
            [packages]="packages"
            [downloadAllUrl]="getDownloadAllPackagesURL(opportunity.id, opportunity.archived)"></sam-download>
          <div class="sam-ui hidden section divider"></div>
        </div>
      </section>

      <!-- Contact Information -->
      <a name="#/opp/{{opportunity.id}}/review#contact"></a>
      <section [attr.id]="generateID(opportunityFields.Contact)" *ngIf="shouldBeDisplayed(opportunityFields.Contact)">
        <div class="sam-ui hidden divider"></div>

        <div grid class="middle aligned">
          <div columns="9">
            <h2 class="sam-ui header">Contact Information</h2>
          </div>
          <div columns="3" class="right aligned">
            <a *ngIf="canEdit()"
              (click)="onEditClick(['#contact'])">
              Edit Section
              <em class="fa fa-pencil" aria-hidden="true"></em>
            </a>
          </div>
        </div>

        <div class="sam-ui segment">
          <div class="usa-grid-full">
            <div class="usa-width-one-half" [attr.id]="generateID(opportunityFields.POC, 'contact-primary')" *ngIf="shouldBeDisplayed(opportunityFields.POC)">
              <h3 class="sam-ui dividing header">
                Primary Point of Contact
              </h3>
              <div *ngIf="opportunity?.data?.pointOfContact != null && opportunity?.data?.pointOfContact.length > 0">
              <div *ngFor="let contact of opportunity.data.pointOfContact">
              <ul class="usa-unstyled-list"  *ngIf="contact && contact?.type == 'primary'">
                <li [attr.id]="generateID(opportunityFields.POCFullName, 'contact-primary')"
                    *ngIf="contact?.fullName && shouldBeDisplayed(opportunityFields.POCFullName)">
                  <strong>{{contact.fullName}}</strong>
                </li>
                <li [attr.id]="generateID(opportunityFields.POCTitle, 'contact-primary')"
                    *ngIf="contact?.title && shouldBeDisplayed(opportunityFields.POCTitle)">
                  <!--TODO: fix capitalize pipe-->
                  <em [innerHTML]="contact.title"></em>
                </li>
                <li [attr.id]="generateID(opportunityFields.POCEmail, 'contact-primary')"
                    *ngIf="contact?.email && shouldBeDisplayed(opportunityFields.POCEmail)">
                  <em class="fa fa-envelope-o" aria-hidden="true"></em> &nbsp;
                  <a href="mailto:{{contact?.email}}">
                    {{contact.email}}
                  </a>
                </li>
                <li [attr.id]="generateID(opportunityFields.POCPhone, 'contact-primary')"
                    *ngIf="contact?.phone && shouldBeDisplayed(opportunityFields.POCPhone)">
                  <em class="fa fa-phone" aria-hidden="true"></em> &nbsp;
                  {{contact.phone}}
                </li>
                <li [attr.id]="generateID(opportunityFields.POCFax, 'contact-primary')"
                    *ngIf="contact?.fax && shouldBeDisplayed(opportunityFields.POCFax)">
                  <em class="fa fa-fax" aria-hidden="true"></em> &nbsp;
                  {{contact.fax}}
                </li>
              </ul>
              </div>
              </div>
            </div>
            <div class="usa-width-one-half" [attr.id]="generateID(opportunityFields.POC, 'contact-secondary')" *ngIf="shouldBeDisplayed(opportunityFields.POC)">
              <h3 class="sam-ui dividing header">
                Secondary Point of Contact
              </h3>
              <div *ngIf="opportunity?.data?.pointOfContact != null && opportunity?.data?.pointOfContact.length > 0">
                <div *ngFor="let contact of opportunity.data.pointOfContact">
              <ul class="usa-unstyled-list" *ngIf="contact && contact.type == 'secondary'">
                <li [attr.id]="generateID(opportunityFields.POCFullName, 'contact-secondary')"
                    *ngIf="contact?.fullName && shouldBeDisplayed(opportunityFields.POCFullName)">
                  <strong>{{contact.fullName}}</strong>
                </li>
                <li [attr.id]="generateID(opportunityFields.POCTitle, 'contact-secondary')"
                    *ngIf="contact?.title && shouldBeDisplayed(opportunityFields.POCTitle)">
                  <!--TODO: fix capitalize pipe-->
                  <em [innerHTML]="contact.title"></em>
                </li>
                <li [attr.id]="generateID(opportunityFields.POCEmail, 'contact-secondary')"
                    *ngIf="contact?.email && shouldBeDisplayed(opportunityFields.POCEmail)">
                  <em class="fa fa-envelope-o" aria-hidden="true"></em> &nbsp;
                  <a href="mailto:{{contact.email}}">
                    {{contact.email}}
                  </a>
                </li>
                <li [attr.id]="generateID(opportunityFields.POCPhone, 'contact-secondary')"
                    *ngIf="contact?.phone && shouldBeDisplayed(opportunityFields.POCPhone)">
                  <em class="fa fa-phone" aria-hidden="true"></em> &nbsp;
                  {{contact.phone}}
                </li>
                <li [attr.id]="generateID(opportunityFields.POCFax, 'contact-secondary')"
                    *ngIf="contact?.fax && shouldBeDisplayed(opportunityFields.POCFax)">
                  <em class="fa fa-fax" aria-hidden="true"></em> &nbsp;
                  {{contact.fax}}
                </li>
              </ul>
            </div>
              </div>
            </div>
          </div>
          <div class="sam-ui hidden section divider"></div>
        </div>
      </section>

      <!-- History -->
      <a name="#/opp/{{opportunity.id}}/review#history"></a>
      <section [attr.id]="generateID(opportunityFields.History)" *ngIf="shouldBeDisplayed(opportunityFields.History)">
        <div class="sam-ui hidden divider"></div>
        <h2 class="sam-ui header">History</h2>
        <div class="sam-ui segment">
          <sam-history *ngIf="processedHistory" [data]="processedHistory" [currentId]="opportunity.id"></sam-history>
          <span *ngIf="noHistory === true">History not available</span>
        </div>
      </section>

      <div *ngIf="showIvls">
      <a name="#/opp/{{opportunity.id}}/review#ivl-summary"></a>
      <section  [attr.id]="generateID(opportunityFields.IVL)" *ngIf="ivls">
        <div class="sam-ui hidden divider"></div>
        <h2 class="sam-ui header">Interested Vendors List</h2>
        <div class="sam-ui segment">

        <div class="usa-width-one-whole">
          <div class="pull-right">
            <input type="text" [(ngModel)] = "keyword" id="search-input-ivl">
            <sam-button
              [attr.id]="'search-ivl-button'"
              [buttonType]="'default'"
              [buttonText]="'Search' "
              [buttonClass]="'usa-button usa-search-submit search-btn'"
              (onClick)="reloadIVLs(0)">
            </sam-button>
          </div>
        </div>
        <h2 class="sam-ui header" id="opportunity-ivl-summary">
          Interested Vendors List
        </h2>

        <div class="sam-ui info message">
          <div class="header">
            <em class="fa fa-id-badge" aria-hidden="true"></em>
            This vendor list is only visible to owners of this opportunity
          </div>
        </div>

        <div class="sam-ui vertically middle aligned padded grid">
          <div class="five wide column">
            <strong>
              <list-results-message [showing]="10" [currentPage]="ivls?.page?.number+1" [total]="ivls?.page?.totalElements" [suffix]="listMessageSuffix"></list-results-message>
            </strong>
          </div>
          <div class="three wide column middle right aligned">
          </div>
          <div class="four wide column">
            <sam-sort
              [options]="ivlSortOptions"
              [(ngModel)]="ivlSort"
              (ngModelChange)="reloadIVLs(0)">
            </sam-sort>
          </div>
        </div>

        <div class="sam-ui grid" id="ivl-list" tabindex="-1" *ngIf="ivls.page?.totalElements > 0">
          <ng-container *ngFor="let element of ivls._embedded?.ivl">

            <div class="sam-ui hidden divider"></div>
            <div tabindex="0">

              <a *ngIf="element.contractorDuns" class="sam-ui" [routerLink]="['/entity', element.contractorDuns]">
                {{ element.contractorName }}
              </a>
              <ng-container *ngIf="!element.contractorDuns" class="sam-ui">
                {{ element.contractorName }}
              </ng-container>
              <div class="sam-ui equal width divided segment grid">
                <div class="row">
                  <div class="column">
                    <div class="sam-ui medium header">
                      UEI (Unique Entity Identifier)
                      <div class="sub header">
                        {{element.contractorDuns}}
                      </div>
                    </div>
                    <div class="sam-ui medium header">
                      CAGE Code
                      <div class="sub header">
                        {{element.contractorCageNumber}}
                      </div>
                    </div>
                  </div>
                  <div class="column">
                    <div class="sam-ui medium header">
                      Address
                      <div class="sub header">
                        {{ element.contractorStreet }} {{ element.contractorCity }} {{ element.contractorState }} {{ element.contractorZip }} {{ element.contractorCountry }}
                      </div>
                    </div>
                  </div>
                  <div class="column">
                    <div class="sam-ui medium header">
                      Contact
                      <div class="sub header">
                        {{element.contactFirstName}} {{element.contactLastName}} <br />
                        <ng-container *ngIf="element.contactEmail"><strong><em class="fa fa-envelope-o" aria-hidden="true"></em></strong> <a href="mailto:{{element.contactEmail}}">{{element.contactEmail}}</a> <br></ng-container>
                        <ng-container *ngIf="element.contactPhone"><strong><em class="fa fa-phone" aria-hidden="true"></em></strong> {{element.contactPhone}}<br></ng-container>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row" *ngIf="ivlNaicsCodeList && element.naics && element.contractorDuns && dictionariesUpdated === true">
                  <div class="usa-width-one-whole">
                    <sam-accordion>
                      <sam-accordion-section headerText="NAICS Classifications" name="aria-friendly-section-name">
                        <table>
                          <thead>
                          <tr>
                            <!--<th>NAICS</th>-->
                            <th>Name</th>
                            <th>Small Business?</th>
                          </tr>
                          </thead>
                          <tbody>
                          <ng-container *ngFor="let naics of element.naics.naicsList | filterMultiArrayObject:findDictionary('naics_code'):'code':false:''">
                            <tr>
                              <!--<td>{{ naics.code }}</td>-->
                              <td>
                                {{ naics.value }}
                              </td>
                              <td>N/A</td>
                            </tr>
                          </ng-container>
                          </tbody>
                        </table>
                      </sam-accordion-section>
                    </sam-accordion>
                  </div>
                </div>
              </div>
            </div>
          </ng-container>
        </div>
        <ng-container *ngIf="ivls.page.totalElements == 0">
          No results found.
        </ng-container>
        </div>
      </section>
      <sam-pagination *ngIf="ivls.page && ivls.page.totalPages && ivls.page.totalPages > 0"
                      (pageChange)="reloadIVLs($event-1)"
                      [currentPage]="ivls.page.number+1"
                      [totalPages]="ivls.page.totalPages">
      </sam-pagination>


    </div>

    </div>

    <br><br>

  </div>
</page>
