<div class="usa-grid usa-register-main">
  <div class="usa-width-one-whole">
    <h1>Complete Sign-Up</h1>
    <span>Thank you for joining the new SAM.gov. To complete the sign-up process and gain account access, please complete the following information.</span>
    <form *ngIf="userForm" [formGroup]="userForm" class="usa-form" autocomplete="off" novalidate>
      <fieldset class="name">
        <sam-name-entry [model]="user" legend="Your Name" #nameEntry></sam-name-entry>

        <sam-phone-entry formControlName="personalPhone"
                         prefix="mobile"
                         [label]="store.labels.personalPhone.label"
                         [hint]="store.labels.personalPhone.hint"
                         [numbersOnly]="true"
                         phoneNumberTemplate="(___)___-____"></sam-phone-entry>
        <sam-autocomplete formControlName="carrier"
                          labelText="Mobile Carrier"
                          [options]="api.iam.carriers"
                          [errorMessage]="errors('carrier')"></sam-autocomplete>

        <ul class="usa-unstyled-list">
          <li>
            <input type="checkbox"
                   id="otp-preference"
                   type="checkbox"
                   name="otp-preference"
                   [checked]="user.OTPPreference == 'sms'"
                   (change)="user.OTPPreference = (user.OTPPreference == 'sms') ? 'email' : 'sms'">
            <label for="otp-preference">Use mobile business phone as my default OTP option</label>
          </li>
          <li>
            <input type="checkbox"
                   id="email-notification"
                   type="checkbox"
                   name="email-notification"
                   [checked]="user.emailNotification"
                   (change)="user.emailNotification = !user.emailNotification">
            <label for="email-notification">I would like to be contacted when changes are made to the new SAM.gov</label>
          </li>
        </ul>
      </fieldset>

      <fieldset class="phone">
        <legend>Business Phone</legend>
        <sam-phone-entry formControlName="workPhone"
                         prefix="work"
                         [control]="userForm.get('workPhone')"
                         [label]="' '"
                         [numbersOnly]="true"
                         [required]="true"
                         #phoneEntry></sam-phone-entry>
      </fieldset>

      <fieldset class="office">
        <div *ngIf="states.isGov; else entityTemplate">
          <legend>Office</legend>
          <sam-agency-picker [advancedMode]="true"
                             [multimode]="false"
                             [orgRoot]="user.departmentID"
                             [orgId]="userForm.controls.officeID.value"
                             [label]="'Select the office you work for:'"
                             [searchMessage]="errors('officeID')"
                             (orgFullPath)="setHierarchy($event)"
                             #agencyPicker>
          </sam-agency-picker>
        </div>
        <ng-template #entityTemplate>
          <legend>Entity</legend>
          <sam-entity-picker name="entity"
                             [formControl]="entity"
                             [hint]="store.labels.entity.hint"
                             [placeholder]="store.labels.entity.placeholder"
                             [label]="' '"
                             [isMultiple]="false">
          </sam-entity-picker>
        </ng-template>
      </fieldset>

      <fieldset class="password">
        <sam-password [password]="userForm.controls.userPassword"
                      [phrases]="[user.firstName, user.middleName, user.lastName, user.email, user.fullName]"
                      #passwordComponent></sam-password>
      </fieldset>

      <fieldset class="kba">
        <legend>Security Questions</legend>
        <span>Select 3 unique questions and provide an answer for each question. Answers must be at least 8 characters long.</span>
        <div *ngFor="let kbaAnswer of userForm.controls.kbaAnswerList.controls; let $index = index;">
          <sam-kba-entry [(questions)]="questions[$index]"
                         [question]="userForm.controls.kbaAnswerList.controls[$index].controls.questionId"
                         [(answer)]="userForm.controls.kbaAnswerList.controls[$index].controls.answer"
                         (onQuestionChange)="changeQuestion($event, $index)"
                         label="Question {{ $index + 1 }}">
          </sam-kba-entry>
        </div>
      </fieldset>

      <div class="usa-button-controls">
        <div class="usa-button-wrapper">
          <button type="button" class="usa-button-outline" (click)="cancel()">Cancel</button>
          <button type="button" [ngClass]="{ 'usa-button-disabled': states.loading }" [disabled]="states.loading" (click)="register()" #controls>Submit</button>
        </div>
        <sam-alert [type]="states.alert.type" [title]="states.alert.message" [showClose]="true" [hidden]="!states.alert.show" (dismiss)="hideAlert()"></sam-alert>
      </div>
    </form>
  </div>
</div>
